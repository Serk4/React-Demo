name: Daily Database Reset

on:
  schedule:
    # Run at 2:00 AM UTC daily (adjust timezone as needed)
    - cron: '0 2 * * *'
  workflow_dispatch:
    # Allow manual trigger for testing

jobs:
  reset-preview:
    name: Reset Preview Database
    runs-on: ubuntu-latest
    steps:
      - name: Reset Preview Database
        run: |
          echo "ğŸ”„ Resetting Preview database..."
          curl -X POST "https://react-demo-preview.vercel.app/api/admin/reset" \
            -H "Content-Type: application/json" \
            -f || echo "âŒ Preview reset failed (database may be in memory mode)"

  reset-production:
    name: Reset Production Database
    runs-on: ubuntu-latest
    needs: reset-preview
    steps:
      - name: Reset Production Database
        run: |
          echo "ğŸ”„ Resetting Production database..."
          curl -X POST "https://react-demo.vercel.app/api/admin/reset" \
            -H "Content-Type: application/json" \
            -f || echo "âŒ Production reset failed (database may be in memory mode)"

  notify:
    name: Notify Results
    runs-on: ubuntu-latest
    needs: [reset-preview, reset-production]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "ğŸ“Š Daily Database Reset Summary"
          echo "Preview: ${{ needs.reset-preview.result }}"
          echo "Production: ${{ needs.reset-production.result }}"

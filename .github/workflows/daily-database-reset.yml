name: Daily Database Reset

on:
  schedule:
    # Run at 2:00 AM UTC daily
    - cron: '0 2 * * *'
  workflow_dispatch:
    # Allow manual trigger for testing
    inputs:
      verbose:
        description: 'Enable verbose logging'
        required: false
        default: true
        type: boolean

jobs:
  database-reset:
    name: Reset Demo Database
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Run Database Reset
        run: |
          cd server
          VERBOSE_FLAG=""

          if [[ "${{ github.event.inputs.verbose }}" == "true" ]]; then
            VERBOSE_FLAG="--verbose"
          fi

          echo "üöÄ Running database reset for demo environment"
          node scripts/simple-reset.js $VERBOSE_FLAG
        env:
          NODE_ENV: production

  notify-results:
    name: Notify Results
    runs-on: ubuntu-latest
    needs: [database-reset]
    if: always()
    steps:
      - name: Summary
        run: |
          echo "üìä Daily Database Reset Complete"
          echo "Status: ${{ needs.database-reset.result }}"
          echo "Time: $(date -u)"

          if [[ "${{ needs.database-reset.result }}" == "success" ]]; then
            echo "‚úÖ Demo database reset completed successfully"
          else
            echo "‚ö†Ô∏è Reset completed with warnings (normal for memory mode)"
          fi
